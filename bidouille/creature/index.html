<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>créature</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #000;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<script>
let t = 0;
let cx, cy;
let vx = 0, vy = 0;
let heading = 0;
let speed = 0;
let targetSpeed = 1.2;
let noiseOff = 0;
let pauseTimer = 0;
let creatureRadius = 200;
let margin;

function setup() {
  createCanvas(windowWidth, windowHeight);
  stroke(255, 120);
  cx = random(creatureRadius, width - creatureRadius);
  cy = random(creatureRadius, height - creatureRadius);
  heading = random(TWO_PI);
  margin = creatureRadius + 40;
}

function organism(x, y) {
  let k = 5 * cos(x / 14) * cos(y / 30);
  let e = y / 8 - 13;

  let d = pow(mag(k, e), 2) / 59 + 4;

  let angleTerm = atan2(k, e);
  let q = 60 - 3 * sin(angleTerm * e);

  let wave = k * (3 + 4 / d * sin(d * d - t * 2));

  let c = d / 2 + e / 99 - t / 18;

  let s = 2;
  let xCoord = (q + wave) * s * sin(c) + cx;
  let yCoord = (q + d * 9) * s * cos(c) + cy;

  point(xCoord, yCoord);
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}

function draw() {
  background(0);
  t += PI / 20;
  noiseOff += 0.003;

  // Pause aléatoire — la créature s'arrête parfois
  if (pauseTimer > 0) {
    pauseTimer--;
    targetSpeed = 0;
    if (pauseTimer === 0) {
      targetSpeed = random(0.6, 2.0);
      heading += random(-PI / 2, PI / 2);
    }
  } else if (random() < 0.003) {
    pauseTimer = floor(random(30, 120));
  }

  // Vitesse variable — accélère et ralentit doucement
  let speedNoise = noise(noiseOff * 2 + 100);
  let desiredSpeed = targetSpeed * map(speedNoise, 0, 1, 0.3, 1.5);
  speed = lerp(speed, desiredSpeed, 0.02);

  // Direction avec Perlin noise — virages doux et naturels
  let turnAmount = (noise(noiseOff) - 0.5) * 0.08;
  heading += turnAmount;

  // Petites saccades occasionnelles
  if (random() < 0.008) {
    heading += random(-PI / 4, PI / 4);
    speed *= 1.5;
  }

  // Vélocité
  vx = cos(heading) * speed;
  vy = sin(heading) * speed;
  cx += vx;
  cy += vy;

  // Rebond doux sur les bords — la créature tourne vers le centre
  let steerStrength = 0.1;
  if (cx < margin) { heading = lerp(heading, 0, steerStrength); speed *= 0.95; }
  if (cx > width - margin) { heading = lerp(heading, PI, steerStrength); speed *= 0.95; }
  if (cy < margin) { heading = lerp(heading, HALF_PI, steerStrength); speed *= 0.95; }
  if (cy > height - margin) { heading = lerp(heading, -HALF_PI, steerStrength); speed *= 0.95; }

  // Sécurité : ne jamais sortir de l'écran (avec marge pour la taille)
  cx = constrain(cx, creatureRadius, width - creatureRadius);
  cy = constrain(cy, creatureRadius, height - creatureRadius);

  for (let i = 0; i < 10000; i++) {
    let x = i % 80;
    let y = i / 43;
    organism(x, y);
  }
}
</script>
</body>
</html>
