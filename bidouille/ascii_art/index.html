<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ASCII Art Renderer</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #0a0a0a;
    color: #ccc;
    font-family: 'Courier New', monospace;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .controls {
    display: flex;
    gap: 16px;
    padding: 16px;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
  }
  .controls label {
    font-size: 13px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .controls select, .controls input[type=range] {
    background: #1a1a1a;
    color: #ccc;
    border: 1px solid #333;
    padding: 4px 8px;
    border-radius: 4px;
    font-family: inherit;
  }
  .controls button {
    background: #2a2a2a;
    color: #ccc;
    border: 1px solid #444;
    padding: 6px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-family: inherit;
  }
  .controls button:hover, .upload-btn:hover { background: #3a3a3a; }
  .upload-btn {
    background: #2a2a2a;
    border: 1px solid #444;
    padding: 6px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
  }
  #width-val { min-width: 30px; text-align: right; }
  #output {
    font-size: 6px;
    line-height: 1.0;
    letter-spacing: 0px;
    white-space: pre;
    padding: 16px;
    overflow: auto;
    max-width: 100vw;
  }
  canvas { display: none; }
</style>
</head>
<body>

<div class="controls">
  <label>Width: <input type="range" id="width" min="40" max="300" value="120"> <span id="width-val">120</span></label>
  <label>Charset:
    <select id="charset">
      <option value="standard">Standard</option>
      <option value="blocks">Block Elements</option>
      <option value="minimal">Minimal</option>
    </select>
  </label>
  <label>Color:
    <select id="colormode">
      <option value="color">Original Color</option>
      <option value="green">Green Monochrome</option>
      <option value="white">White Monochrome</option>
    </select>
  </label>
  <label class="upload-btn">Upload image <input type="file" id="file-input" accept="image/*" style="display:none"></label>
  <button id="render-btn">Render</button>
</div>

<div id="output"></div>
<canvas id="canvas"></canvas>

<script>
let currentImgSrc = '623364294_10162706363011801_2825125911614225702_n.jpg';

const CHARSETS = {
  standard: ' .\'`^",:;Il!i><~+_-?][}{1)(|/tfjrxnuvczXYUJCLQ0OZmwqpdbkhao*#MW&8%B@$',
  blocks:   ' ░▒▓█',
  minimal:  ' .-:=+*#%@'
};

const widthSlider = document.getElementById('width');
const widthVal = document.getElementById('width-val');
const charsetSel = document.getElementById('charset');
const colorSel = document.getElementById('colormode');
const output = document.getElementById('output');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

widthSlider.addEventListener('input', () => { widthVal.textContent = widthSlider.value; render(); });
charsetSel.addEventListener('change', render);
colorSel.addEventListener('change', render);

function render() {
  const img = new Image();
  img.onload = () => {
    const cols = parseInt(widthSlider.value);
    // Characters are ~2x taller than wide, so halve the row count
    const aspect = img.height / img.width;
    const rows = Math.round(cols * aspect * 0.5);

    canvas.width = cols;
    canvas.height = rows;
    ctx.drawImage(img, 0, 0, cols, rows);
    const data = ctx.getImageData(0, 0, cols, rows).data;

    const chars = CHARSETS[charsetSel.value];
    const mode = colorSel.value;
    const maxIdx = chars.length - 1;

    let html = '';
    for (let y = 0; y < rows; y++) {
      for (let x = 0; x < cols; x++) {
        const i = (y * cols + x) * 4;
        const r = data[i], g = data[i+1], b = data[i+2];
        const lum = 0.299 * r + 0.587 * g + 0.114 * b;
        // Map luminance (0-255) to character index (dark=dense, light=sparse)
        const ci = Math.round((lum / 255) * maxIdx);
        const ch = chars[ci] === ' ' ? '&nbsp;' : chars[ci].replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');

        if (mode === 'color') {
          html += `<span style="color:rgb(${r},${g},${b})">${ch}</span>`;
        } else if (mode === 'green') {
          const brightness = Math.round(40 + (lum / 255) * 215);
          html += `<span style="color:rgb(0,${brightness},0)">${ch}</span>`;
        } else {
          html += ch;
        }
      }
      html += '\n';
    }
    output.innerHTML = html;
  };
  img.src = currentImgSrc;
}

document.getElementById('file-input').addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  currentImgSrc = URL.createObjectURL(file);
  render();
});

document.getElementById('render-btn').addEventListener('click', render);

// Initial render
render();
</script>
</body>
</html>
