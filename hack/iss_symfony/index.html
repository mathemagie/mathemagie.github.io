<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Real-time International Space Station tracker using Mercator projection">
    <meta name="keywords" content="ISS, space station, tracker, real-time, Mercator projection, p5.js">
    <meta name="author" content="ISS Tracker">
    
    <title>Real-Time ISS Tracker - Mercator Projection</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="css/styles.css" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js" as="script">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/images/iss-icon.svg">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Real-Time ISS Tracker">
    <meta property="og:description" content="Track the International Space Station in real-time with Mercator projection visualization">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; connect-src 'self' https://api.wheretheiss.at; style-src 'self' 'unsafe-inline'; img-src 'self' data:; media-src 'self';">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen" aria-hidden="true">
        <div class="loading-spinner"></div>
        <p>Initializing ISS Tracker...</p>
    </div>

    <!-- Main Application Container -->
    <div class="app-container" role="main">
        <!-- Header -->
        <header class="header" role="banner">
            <h1 class="app-title">
                <img src="assets/images/iss-icon.svg" alt="ISS Icon" class="header-icon" width="32" height="32">
                Real-Time ISS Tracker
            </h1>
            <nav class="header-nav" role="navigation">
                <button id="info-btn" class="nav-btn" aria-label="Show information about this application">
                    ‚ÑπÔ∏è Info
                </button>
                <button id="fullscreen-btn" class="nav-btn" aria-label="Toggle fullscreen mode">
                    ‚õ∂ Fullscreen
                </button>
            </nav>
        </header>

        <!-- Map Container -->
        <main class="map-container" role="main">
            <div id="map-canvas" class="map-canvas" role="img" aria-label="World map showing ISS position">
                <!-- p5.js canvas will be inserted here -->
            </div>
            
            <!-- Map Overlay -->
            <div class="map-overlay">
                <div class="coordinates-display" role="status" aria-live="polite">
                    <div class="coordinate-item">
                        <label for="lat-display">Latitude:</label>
                        <span id="lat-display" class="coordinate-value">--¬∞</span>
                    </div>
                    <div class="coordinate-item">
                        <label for="lng-display">Longitude:</label>
                        <span id="lng-display" class="coordinate-value">--¬∞</span>
                    </div>
                    <div class="coordinate-item">
                        <label for="alt-display">Altitude:</label>
                        <span id="alt-display" class="coordinate-value">-- km</span>
                    </div>
                    <div class="coordinate-item">
                        <label for="speed-display">Speed:</label>
                        <span id="speed-display" class="coordinate-value">-- km/h</span>
                    </div>
                </div>

                <!-- ISS Info Panel -->
                <div class="iss-info-panel" role="complementary">
                    <h3>ISS Status</h3>
                    <div class="info-item">
                        <span class="info-label">Last Update:</span>
                        <span id="last-update" class="info-value">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Next Update:</span>
                        <span id="next-update" class="info-value">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Connection:</span>
                        <span id="connection-status" class="info-value status-indicator">DISCONNECTED</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Controls Panel -->
        <aside class="controls-panel" role="complementary">
            <section class="control-section">
                <h2>Tracking Controls</h2>
                
                <!-- Primary Controls -->
                <div class="primary-controls">
                    <button id="tracking-toggle" class="primary-btn" aria-pressed="false">
                        <span class="btn-icon">‚ñ∂Ô∏è</span>
                        <span class="btn-text">Start Tracking</span>
                    </button>
                    
                    <button id="center-iss" class="secondary-btn" disabled aria-label="Center map on ISS position">
                        üéØ Center ISS
                    </button>
                </div>

                <!-- Update Frequency -->
                <div class="control-group">
                    <label for="update-frequency">Update Frequency:</label>
                    <select id="update-frequency" class="control-select" aria-describedby="frequency-help">
                        <option value="1000">1 second</option>
                        <option value="2000" selected>2 seconds</option>
                        <option value="5000">5 seconds</option>
                        <option value="10000">10 seconds</option>
                    </select>
                    <small id="frequency-help" class="help-text">How often to fetch new ISS position</small>
                </div>

                <!-- Display Options -->
                <div class="control-group">
                    <fieldset>
                        <legend>Display Options</legend>
                        <label class="checkbox-label">
                            <input type="checkbox" id="show-orbit-path" checked>
                            <span class="checkmark"></span>
                            Show Orbital Path
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="show-grid" checked>
                            <span class="checkmark"></span>
                            Show Grid Lines
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="show-coordinates">
                            <span class="checkmark"></span>
                            Show Coordinates
                        </label>
                    </fieldset>
                </div>
            </section>

            <!-- Audio Controls -->
            <section class="control-section">
                <h2>Audio Feedback</h2>
                
                <div class="audio-controls">
                    <label class="checkbox-label">
                        <input type="checkbox" id="audio-enabled" checked>
                        <span class="checkmark"></span>
                        Enable Audio
                    </label>
                    
                    <div class="volume-control">
                        <label for="volume-slider">Volume:</label>
                        <div class="volume-slider-container">
                            <button id="mute-btn" class="volume-btn" aria-label="Toggle mute">üîä</button>
                            <input type="range" id="volume-slider" min="0" max="100" value="70" 
                                   class="volume-slider" aria-label="Adjust volume">
                            <span id="volume-display" class="volume-display">70%</span>
                        </div>
                    </div>

                    <div class="audio-info">
                        <small>Audio plays when ISS crosses major grid lines (10¬∞ intervals)</small>
                    </div>
                </div>
            </section>

            <!-- Performance Monitor -->
            <section class="control-section">
                <h2>Performance</h2>
                <div class="performance-stats">
                    <div class="stat-item">
                        <span class="stat-label">FPS:</span>
                        <span id="fps-display" class="stat-value">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">API Response:</span>
                        <span id="api-response-time" class="stat-value">--ms</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Memory:</span>
                        <span id="memory-usage" class="stat-value">--MB</span>
                    </div>
                </div>
            </section>

            <!-- Debug Panel (Hidden by default) -->
            <section class="control-section debug-panel" id="debug-panel" style="display: none;">
                <h2>Debug Information</h2>
                <div class="debug-info">
                    <div class="debug-item">
                        <span class="debug-label">API Endpoint:</span>
                        <span id="debug-api-endpoint" class="debug-value">--</span>
                    </div>
                    <div class="debug-item">
                        <span class="debug-label">Projection Error:</span>
                        <span id="debug-projection-error" class="debug-value">--px</span>
                    </div>
                    <div class="debug-item">
                        <span class="debug-label">Update Errors:</span>
                        <span id="debug-update-errors" class="debug-value">0</span>
                    </div>
                </div>
                <button id="clear-debug" class="debug-btn">Clear Debug Log</button>
            </section>
        </aside>

        <!-- Footer -->
        <footer class="footer" role="contentinfo">
            <div class="footer-content">
                <p class="footer-text">
                    Data from <a href="http://open-notify.org/" target="_blank" rel="noopener">Open Notify API</a> | 
                    Built with <a href="https://p5js.org/" target="_blank" rel="noopener">p5.js</a>
                </p>
                <div class="footer-stats">
                    <span>Version 1.0</span> | 
                    <span id="session-time">Session: 00:00</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Error Modal -->
    <div id="error-modal" class="modal" role="dialog" aria-hidden="true" aria-labelledby="error-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="error-title">Connection Error</h2>
                <button class="modal-close" aria-label="Close error dialog">√ó</button>
            </div>
            <div class="modal-body">
                <p id="error-message">Unable to connect to ISS tracking services.</p>
                <p class="error-suggestion">
                    <strong>Suggestions:</strong>
                    <ul>
                        <li>Check your internet connection</li>
                        <li>Refresh the page to try again</li>
                        <li>Try again in a few moments</li>
                    </ul>
                </p>
            </div>
            <div class="modal-footer">
                <button id="retry-btn" class="primary-btn">Retry Connection</button>
                <button id="dismiss-error" class="secondary-btn">Continue Offline</button>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="info-modal" class="modal" role="dialog" aria-hidden="true" aria-labelledby="info-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="info-title">About ISS Tracker</h2>
                <button class="modal-close" aria-label="Close info dialog">√ó</button>
            </div>
            <div class="modal-body">
                <p>This application tracks the International Space Station in real-time using Mercator projection.</p>
                
                <h3>Features:</h3>
                <ul>
                    <li>Real-time ISS position updates every 2 seconds</li>
                    <li>Accurate Mercator projection mathematics</li>
                    <li>Audio feedback when crossing grid lines</li>
                    <li>Orbital path visualization</li>
                    <li>Mobile-responsive design</li>
                </ul>

                <h3>Data Sources:</h3>
                <ul>
                    <li>Primary: <a href="http://open-notify.org/" target="_blank" rel="noopener">Open Notify API</a></li>
                    <li>Backup: <a href="https://wheretheiss.at/" target="_blank" rel="noopener">Where the ISS at?</a></li>
                </ul>

                <h3>Technical Information:</h3>
                <p>Built with HTML5, CSS3, JavaScript, and p5.js. Uses mathematical Mercator projection for accurate coordinate mapping.</p>
            </div>
            <div class="modal-footer">
                <button class="primary-btn modal-close">Got it!</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Load p5.js from CDN with fallback -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js" 
            crossorigin="anonymous" 
            onerror="loadP5Fallback()">
    </script>
    
    <script>
        function loadP5Fallback() {
            console.warn('CDN failed, loading p5.js from alternative source');
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/p5@1.7.0/lib/p5.min.js';
            script.onerror = function() {
                console.error('All p5.js sources failed. Please check your internet connection.');
                document.getElementById('loading-screen').innerHTML = 
                    '<div class="loading-spinner"></div><p style="color: #ff6b35;">Failed to load p5.js library.<br>Please refresh the page or check your internet connection.</p>';
            };
            document.head.appendChild(script);
        }
    </script>

    <!-- Application Scripts -->
    <script src="js/mercatorProjection.js"></script>
    <script src="js/apiClient.js"></script>
    <script src="js/audioManager.js"></script>
    <script src="js/issTracker.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>