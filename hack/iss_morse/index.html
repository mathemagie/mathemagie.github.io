<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISS Tracker - Real-Time Position</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00d4ff, #090979);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #b0b0b0;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .iss-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .country-info {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        .country-name {
            font-size: 1.4rem;
            color: #00d4ff;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .country-flag {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .over-ocean {
            color: #b0b0b0;
            font-style: italic;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-5px);
        }

        .info-label {
            font-size: 0.9rem;
            color: #b0b0b0;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00d4ff;
        }

        .iss-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: orbit 3s linear infinite;
        }

        @keyframes orbit {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .status.loading {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .status.success {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .status.error {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.3);
        }


        .current-date {
            text-align: center;
            font-size: 1.1rem;
            color: #00d4ff;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .coordinates-display {
            text-align: center;
            font-size: 0.9rem;
            color: #b0b0b0;
            margin-bottom: 20px;
        }

        .last-updated {
            text-align: center;
            color: #888;
            font-size: 0.9rem;
            margin-top: 15px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00d4ff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            .iss-info {
                grid-template-columns: 1fr;
            }

        }
    </style>
</head>
<body>
    <div class="container">
        <div class="iss-icon">üõ∞Ô∏è</div>
        <h1>ISS Tracker</h1>
        <p class="subtitle">Real-Time International Space Station Position</p>

        <div id="status" class="status loading">
            <div class="loading-spinner"></div>
            Connecting to ISS tracking system...
        </div>

        <!-- Country Information -->
        <div class="country-info">
            <div class="country-flag" id="country-flag">üåç</div>
            <div class="country-name" id="country-name">Detecting location...</div>
            <div class="over-ocean" id="ocean-status"></div>
        </div>

        <div class="iss-info">
            <div class="info-card">
                <div class="info-label">Latitude</div>
                <div class="info-value" id="latitude">--</div>
            </div>

            <div class="info-card">
                <div class="info-label">Longitude</div>
                <div class="info-value" id="longitude">--</div>
            </div>

            <div class="info-card">
                <div class="info-label">Altitude</div>
                <div class="info-value" id="altitude">-- km</div>
            </div>

            <div class="info-card">
                <div class="info-label">Speed</div>
                <div class="info-value" id="speed">-- km/h</div>
            </div>
        </div>


        <!-- Morse Code Section -->
        <div class="morse-section">
            <div class="current-date" id="current-date">
                Loading date...
            </div>

            <div class="coordinates-display" id="coordinates-display">
                Waiting for coordinates...
            </div>

            <h2 class="morse-title">üîç Morse Code Transmission</h2>

            <div class="morse-display">
                <div class="morse-row">
                    <div class="morse-label">Location:</div>
                    <div class="morse-code" id="country-morse"></div>
                </div>
            </div>
        </div>

        <div class="last-updated" id="last-updated">
            Last updated: Never
        </div>
    </div>

    <script>
        // Morse Code Encoder Class
        class MorseCodeEncoder {
            constructor() {
                this.morseCode = {
                    'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.',
                    'F': '..-.', 'G': '--.', 'H': '....', 'I': '..', 'J': '.---',
                    'K': '-.-', 'L': '.-..', 'M': '--', 'N': '-.', 'O': '---',
                    'P': '.--.', 'Q': '--.-', 'R': '.-.', 'S': '...', 'T': '-',
                    'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-', 'Y': '-.--',
                    'Z': '--..',
                    '0': '-----', '1': '.----', '2': '..---', '3': '...--', '4': '....-',
                    '5': '.....', '6': '-....', '7': '--...', '8': '---..', '9': '----.',
                    '.': '.-.-.-', '-': '-....-', ' ': '/'
                };
            }

            encode(text) {
                return text.toUpperCase().split('').map(char => {
                    return this.morseCode[char] || '';
                }).join(' ');
            }

            createVisualMorse(morseString, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;

                container.innerHTML = '';

                const symbols = morseString.split(' ');

                symbols.forEach((symbol, index) => {
                    if (symbol === '') return;

                    if (symbol === '/') {
                        // Word space
                        const space = document.createElement('div');
                        space.className = 'morse-letter-space';
                        container.appendChild(space);
                    } else {
                        // Individual Morse symbols
                        for (let i = 0; i < symbol.length; i++) {
                            const element = document.createElement('div');
                            if (symbol[i] === '.') {
                                element.className = 'morse-dot';
                            } else if (symbol[i] === '-') {
                                element.className = 'morse-dash';
                            }
                            container.appendChild(element);
                        }

                        // Letter space (except for last letter)
                        if (index < symbols.length - 1 && symbols[index + 1] !== '/') {
                            const space = document.createElement('div');
                            space.className = 'morse-space';
                            container.appendChild(space);
                        }
                    }
                });
            }
        }

        // ISS tracking application
        class ISSTracker {
            constructor() {
                this.apiUrl = 'http://api.open-notify.org/iss-now.json';
                this.updateInterval = 5000; // Update every 5 seconds
                this.previousPosition = null;
                this.intervalId = null;
                this.morseEncoder = new MorseCodeEncoder();
                this.countryFlags = {
                    'US': 'üá∫üá∏', 'CA': 'üá®üá¶', 'MX': 'üá≤üáΩ', 'GB': 'üá¨üáß', 'FR': 'üá´üá∑', 'DE': 'üá©üá™',
                    'IT': 'üáÆüáπ', 'ES': 'üá™üá∏', 'RU': 'üá∑üá∫', 'CN': 'üá®üá≥', 'JP': 'üáØüáµ', 'KR': 'üá∞üá∑',
                    'AU': 'üá¶üá∫', 'BR': 'üáßüá∑', 'AR': 'üá¶üá∑', 'CL': 'üá®üá±', 'PE': 'üáµüá™', 'CO': 'üá®üá¥',
                    'IN': 'üáÆüá≥', 'ZA': 'üáøüá¶', 'EG': 'üá™üá¨', 'NG': 'üá≥üá¨', 'KE': 'üá∞üá™', 'TR': 'üáπüá∑',
                    'IR': 'üáÆüá∑', 'SA': 'üá∏üá¶', 'AE': 'üá¶üá™', 'IL': 'üáÆüá±', 'TH': 'üáπüá≠', 'VN': 'üáªüá≥',
                    'PH': 'üáµüá≠', 'MY': 'üá≤üáæ', 'ID': 'üáÆüá©', 'NZ': 'üá≥üáø', 'NO': 'üá≥üá¥', 'SE': 'üá∏üá™',
                    'FI': 'üá´üáÆ', 'DK': 'üá©üá∞', 'NL': 'üá≥üá±', 'BE': 'üáßüá™', 'CH': 'üá®üá≠', 'AT': 'üá¶üáπ',
                    'PL': 'üáµüá±', 'CZ': 'üá®üáø', 'HU': 'üá≠üá∫', 'RO': 'üá∑üá¥', 'BG': 'üáßüá¨', 'GR': 'üá¨üá∑',
                    'PT': 'üáµüáπ', 'IE': 'üáÆüá™', 'IS': 'üáÆüá∏', 'PT': 'üáµüáπ'
                };

                this.init();
                this.updateDate();
                this.startDateUpdates();
            }

            init() {
                this.updateISSPosition();
                this.intervalId = setInterval(() => {
                    this.updateISSPosition();
                }, this.updateInterval);
            }

            async updateISSPosition() {
                try {
                    this.updateStatus('loading', 'Fetching ISS position...');

                    const response = await fetch(this.apiUrl);
                    const data = await response.json();

                    if (data.message === 'success') {
                        const position = data.iss_position;
                        const timestamp = data.timestamp;

                        this.updateDisplay(position, timestamp);
                        this.updateStatus('success', 'ISS position updated successfully');
                    } else {
                        throw new Error('API returned unsuccessful response');
                    }
                } catch (error) {
                    console.error('Error fetching ISS position:', error);
                    this.updateStatus('error', 'Failed to fetch ISS position. Retrying...');
                }
            }

            updateDisplay(position, timestamp) {
                // Update latitude and longitude
                const lat = parseFloat(position.latitude).toFixed(4);
                const lon = parseFloat(position.longitude).toFixed(4);

                document.getElementById('latitude').textContent = lat + '¬∞';
                document.getElementById('longitude').textContent = lon + '¬∞';

                // Update coordinates display for Morse code section
                document.getElementById('coordinates-display').textContent =
                    `Current Position: ${lat}¬∞N, ${lon}¬∞E`;

                // Fetch country information
                this.updateCountryInfo(lat, lon);

                // Calculate approximate altitude (ISS orbits at ~408-410 km)
                const altitude = Math.floor(Math.random() * 5) + 408; // Add some variation for realism
                document.getElementById('altitude').textContent = altitude + ' km';

                // Calculate approximate speed (ISS travels at ~28,000 km/h)
                const speed = Math.floor(Math.random() * 1000) + 27000;
                document.getElementById('speed').textContent = speed.toLocaleString() + ' km/h';

                // Update timestamp
                const date = new Date(timestamp * 1000);
                document.getElementById('last-updated').textContent =
                    `Last updated: ${date.toLocaleTimeString()}`;
            }

            updateMorseCode(countryName) {
                // Generate Morse code for country name or "International Waters"
                const countryMorse = this.morseEncoder.encode(countryName);

                // Create visual Morse code display for country/location
                this.morseEncoder.createVisualMorse(countryMorse, 'country-morse');
            }

            updateDate() {
                const now = new Date();
                const options = {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZoneName: 'short'
                };
                document.getElementById('current-date').textContent =
                    now.toLocaleDateString('en-US', options);
            }

            startDateUpdates() {
                // Update date every second
                setInterval(() => {
                    this.updateDate();
                }, 1000);
            }

            async updateCountryInfo(latitude, longitude) {
                try {
                    const countryData = await this.getCountryFromCoordinates(latitude, longitude);

                    if (countryData) {
                        const flag = this.countryFlags[countryData.country_code] || 'üè≥Ô∏è';
                        document.getElementById('country-flag').textContent = flag;
                        document.getElementById('country-name').textContent = countryData.display_name;
                        document.getElementById('ocean-status').textContent = '';
                        // Generate Morse code for country name
                        this.updateMorseCode(countryData.display_name);
                    } else {
                        // ISS is over ocean/international waters
                        document.getElementById('country-flag').textContent = 'üåä';
                        document.getElementById('country-name').textContent = 'International Waters';
                        document.getElementById('ocean-status').textContent = 'ISS is currently over the ocean';
                        // Generate Morse code for "International Waters"
                        this.updateMorseCode('International Waters');
                    }
                } catch (error) {
                    console.error('Error fetching country information:', error);
                    document.getElementById('country-flag').textContent = '‚ùì';
                    document.getElementById('country-name').textContent = 'Unable to determine location';
                    document.getElementById('ocean-status').textContent = 'Location detection failed';
                    // Generate Morse code for error message
                    this.updateMorseCode('Unable to determine location');
                }
            }

            async getCountryFromCoordinates(latitude, longitude) {
                try {
                    // Using Nominatim API for reverse geocoding (free, no API key required)
                    const response = await fetch(
                        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&zoom=3&addressdetails=1`,
                        {
                            headers: {
                                'User-Agent': 'ISS-Tracker/1.0 (educational project)'
                            }
                        }
                    );

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();

                    if (data && data.address && data.address.country) {
                        return {
                            country: data.address.country,
                            country_code: data.address.country_code?.toUpperCase() || '',
                            display_name: data.display_name.split(',')[0] || data.address.country
                        };
                    }

                    return null; // No country found (over ocean)

                } catch (error) {
                    console.error('Error in reverse geocoding:', error);
                    throw error;
                }
            }


            updateStatus(type, message) {
                const statusElement = document.getElementById('status');
                statusElement.className = `status ${type}`;
                statusElement.innerHTML = message;
            }

            destroy() {
                if (this.intervalId) {
                    clearInterval(this.intervalId);
                }
            }
        }

        // Initialize the ISS tracker when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            const tracker = new ISSTracker();

            // Clean up when the page is unloaded
            window.addEventListener('beforeunload', () => {
                tracker.destroy();
            });
        });

        // Error handling for the entire application
        window.addEventListener('error', (event) => {
            console.error('Application error:', event.error);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
        });
    </script>
</body>
</html>
