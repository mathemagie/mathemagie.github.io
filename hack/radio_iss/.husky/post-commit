#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

cd hack/radio_iss || exit 0

echo "ðŸ”„ Updating version comment with latest commit hash..."
node scripts/update-version-pre-commit.js

# Amend commit only if index.html differs from HEAD (handles staged or unstaged)
if ! git diff --quiet HEAD -- index.html; then
  git add index.html
  git commit --amend --no-edit --no-verify
  echo "ðŸ“ Amended commit with updated version comment"
else
  echo "â„¹ï¸  Version comment already up to date; no amend needed"
fi

echo "ðŸ§ª Verifying deployment..."
chmod +x verify-deployment.sh 2>/dev/null || true
./verify-deployment.sh || true