#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

cd hack/radio_iss || exit 0

echo "🔄 Updating version comment with latest commit hash..."
node scripts/update-version-pre-commit.js

# Amend commit only if index.html changed
if ! git diff --quiet -- index.html; then
  git add index.html
  git commit --amend --no-edit --no-verify
  echo "📝 Amended commit with updated version comment"
else
  echo "ℹ️  Version comment already up to date; no amend needed"
fi

echo "🧪 Verifying deployment..."
chmod +x verify-deployment.sh 2>/dev/null || true
./verify-deployment.sh || true